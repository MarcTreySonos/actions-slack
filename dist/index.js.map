{"version":3,"file":"index.js","sources":["../webpack://actions-slack/./lib/client.js","../webpack://actions-slack/./lib/main.js","../webpack://actions-slack/../../../../usr/local/lib/node_modules/@vercel/ncc/dist/ncc/@@notfound.js","../webpack://actions-slack/webpack/bootstrap","../webpack://actions-slack/webpack/runtime/compat","../webpack://actions-slack/webpack/startup"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Client = void 0;\nconst core = __importStar(require(\"@actions/core\"));\nconst github = __importStar(require(\"@actions/github\"));\nconst webhook_1 = require(\"@slack/webhook\");\nclass Client {\n    constructor() {\n        if (process.env.GITHUB_TOKEN === undefined) {\n            throw new Error('Specify secrets.GITHUB_TOKEN');\n        }\n        this.github = github.getOctokit(process.env.GITHUB_TOKEN);\n        if (process.env.SLACK_WEBHOOK_URL === undefined) {\n            throw new Error('Specify secrets.SLACK_WEBHOOK_URL');\n        }\n        this.webhook = new webhook_1.IncomingWebhook(process.env.SLACK_WEBHOOK_URL);\n    }\n    sendMessage(status, text) {\n        return __awaiter(this, void 0, void 0, function* () {\n            var color = '';\n            switch (status) {\n                case 'success':\n                    color = 'good';\n                    break;\n                case 'failure':\n                    color = 'danger';\n                    break;\n                case 'cancelled':\n                    color = 'warning';\n                    break;\n                default:\n                    throw new Error('The status must be success or failure or cancelled');\n            }\n            const payload = {\n                text: text,\n                attachments: [\n                    {\n                        color: color,\n                        fields: yield this.fields(),\n                    },\n                ],\n            };\n            this.send(payload);\n        });\n    }\n    fields() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this.github === undefined) {\n                throw Error('Specify secrets.GITHUB_TOKEN');\n            }\n            const { owner, repo } = github.context.repo;\n            const { sha } = github.context;\n            return [\n                {\n                    title: 'GitHub Actions',\n                    value: `<https://github.com/${owner}/${repo}/commit/${sha}/checks|Workflow>`,\n                }\n            ];\n        });\n    }\n    send(payload) {\n        return __awaiter(this, void 0, void 0, function* () {\n            core.debug(JSON.stringify(github.context, null, 2));\n            yield this.webhook.send(payload);\n            core.debug('send message');\n        });\n    }\n}\nexports.Client = Client;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst core = __importStar(require(\"@actions/core\"));\nconst client_1 = require(\"./client\");\nfunction run() {\n    return __awaiter(this, void 0, void 0, function* () {\n        try {\n            let status = core.getInput('status', { required: true });\n            status = status.toLowerCase();\n            const success_text = core.getInput('success_text');\n            const failure_text = core.getInput('failure_text');\n            const cancelled_text = core.getInput('cancelled_text');\n            core.debug(`status: ${status}`);\n            core.debug(`success_text: ${success_text}`);\n            core.debug(`failure_text: ${failure_text}`);\n            core.debug(`cancelled_text: ${cancelled_text}`);\n            const client = new client_1.Client();\n            var message = '';\n            switch (status) {\n                case 'success':\n                    message = success_text;\n                    break;\n                case 'failure':\n                    message = failure_text;\n                    break;\n                case 'cancelled':\n                    message = cancelled_text;\n                    break;\n                default:\n                    throw new Error('You can specify success or failure or cancelled');\n            }\n            yield client.sendMessage(status, message);\n        }\n        catch (error) {\n            let errorMessage = \"Failed to do something exceptional\";\n            if (error instanceof Error) {\n                errorMessage = error.message;\n            }\n            core.setFailed(errorMessage);\n        }\n    });\n}\nrun();\n",null,"// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\tvar threw = true;\n\ttry {\n\t\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\t\tthrew = false;\n\t} finally {\n\t\tif(threw) delete __webpack_module_cache__[moduleId];\n\t}\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","\nif (typeof __webpack_require__ !== 'undefined') __webpack_require__.ab = __dirname + \"/\";","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(389);\n"],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;;;;;;ACtGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;;;;;AC5EA;AACA;AACA;A;;;;;AAFA;AACA;AACA;A;;;;;AAFA;AACA;AACA;A;;;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC7BA;AACA;;ACDA;AACA;AACA;AACA;;;;A","sourceRoot":""}